{% extends 'base/base.html' %}
{% load static %}


{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
<link rel="stylesheet" href="{% static 'css/compiled-tailwind/compiled-tailwind.min.css' %}" />
{% endblock %}


{% block body %}
{%csrf_token%}
<div class="w-full mb-5">
    <div class="flex flex-wrap">
        <div class="w-full p-3">
            <div class="text-base font-bold">
                <h2>{{article.title}}</h2>
                <input type="hidden" name="slug" value="{{article.slug}}">
            </div>
            <div>
                <img src="{{article.img.url}}"/>
            </div>
        </div>
        <div class="w-full p-3">
            {{article.content | safe}} 
        </div>
    </div>
</div>

<div class="w-full mt-5">
<div class="flex">
    <div class="text-base font-bold">
        <h1>Berita Terkait</h1>
    </div>
    <div class="flex">
        {% for suggest in suggestion %}
        <div class="p-3">
            <a href="">{{suggest.title}}</a>
        </div>
        {% endfor %}
    </div>
</div>
</div>


<!-- JS untuk laporan jika ada pengunjung membaca, maka jumlah visitor akan bertambah didatabase -->
<script>
var csrf_token = document.getElementsByName('csrfmiddlewaretoken')[0].value;
async function reportVisitor() {
    const setting = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrf_token,
        },
        body: JSON.stringify({
            'slug': '{{article.slug}}'
        })
    }

    let response = await fetch('/blog-service/report-visitor/', setting);

    if (response.status === 200) {
        console.log('success');
    }
}
setTimeout(reportVisitor, 7000);
</script>
{% endblock %}